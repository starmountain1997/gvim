-- =============================================================================
-- === nvim-tree.lua é…ç½® ===
-- =============================================================================
-- nvim-tree æ˜¯ Neovim çš„æ–‡ä»¶æµè§ˆå™¨æ’ä»¶
-- ç®€åŒ–é…ç½®ï¼šåªéœ€è¦ F1 é”®æŠ˜å /æ‰“å¼€æ–‡ä»¶æ ‘

local function on_attach(bufnr)
  local api = require("nvim-tree.api")

  -- åº”ç”¨é»˜è®¤é”®ä½æ˜ å°„ï¼ˆä¿ç•™åŸºæœ¬åŠŸèƒ½ï¼‰
  api.config.mappings.default_on_attach(bufnr)

  -- ä¸éœ€è¦è‡ªå®šä¹‰æ˜ å°„ï¼Œä½¿ç”¨å…¨å±€ F1 é”®å³å¯
end

-- =============================================================================
-- === ä¸»é…ç½® ===
-- =============================================================================
require("nvim-tree").setup({
  -- =========================================================================
  -- === è§†å›¾é…ç½® ===
  -- =========================================================================
  view = {
    -- æ–‡ä»¶æ ‘å®½åº¦
    width = 30,
    -- æ˜¯å¦æ˜¾ç¤ºç›¸å¯¹è¡Œå·
    relativenumber = false,
    -- æ˜¯å¦æ˜¾ç¤ºè¡Œå·
    number = false,
    -- æ˜¯å¦æ˜¾ç¤ºå›¾æ ‡
    signcolumn = "yes",
    -- æµ®åŠ¨çª—å£é…ç½®
    float = {
      enable = false,  -- ç¦ç”¨æµ®åŠ¨çª—å£ï¼Œä½¿ç”¨ä¾§è¾¹æ 
    },
    -- è‡ªé€‚åº”å¤§å°
    adaptive_size = false,
  },

  -- =========================================================================
  -- === æ¸²æŸ“å™¨é…ç½® ===
  -- =========================================================================
  renderer = {
    -- æ ¹æ–‡ä»¶å¤¹æ˜¾ç¤ºæ¨¡å¼
    root_folder_label = ":~:s?$?/..?",
    -- æ˜¯å¦é«˜äº® Git çŠ¶æ€
    highlight_git = true,
    -- æ˜¯å¦æ˜¾ç¤ºå›¾æ ‡
    icons = {
      show = {
        file = true,
        folder = true,
        folder_arrow = true,
        git = true,
      },
      -- å›¾æ ‡æ ·å¼
      glyphs = {
        default = "ğŸ“„",
        symlink = "ğŸ”—",
        bookmark = "ğŸ”–",
        modified = "â—",
        folder = {
          arrow_closed = "â–¶",
          arrow_open = "â–¼",
          default = "ğŸ“",
          open = "ğŸ“‚",
          empty = "ğŸ“",
          empty_open = "ğŸ“‚",
          symlink = "ğŸ”—",
          symlink_open = "ğŸ”—",
        },
        git = {
          unstaged = "âœ—",
          staged = "âœ“",
          unmerged = "âŒ¥",
          renamed = "âœ",
          untracked = "â˜…",
          deleted = "âœ–",
          ignored = "â—Œ",
        },
      },
    },
    -- æ˜¯å¦å°†ç©ºæ–‡ä»¶å¤¹åˆ†ç»„æ˜¾ç¤º
    group_empty = false,
    -- æ˜¯å¦ç‰¹æ®Šæ˜¾ç¤ºå¯æ‰§è¡Œæ–‡ä»¶
    special_files = { "Cargo.toml", "Makefile", "README.md", "readme.md" },
  },

  -- =========================================================================
  -- === æ–‡ä»¶ç³»ç»Ÿé…ç½® ===
  -- =========================================================================
  actions = {
    -- æ–‡ä»¶æ“ä½œå»¶è¿Ÿ
    change_dir = {
      enable = true,
      global = false,
    },
    -- ä½¿ç”¨ç³»ç»Ÿå‰ªè´´æ¿
    use_system_clipboard = true,
    -- æ–‡ä»¶æ‰“å¼€è¡Œä¸º
    open_file = {
      quit_on_open = false,  -- æ‰“å¼€æ–‡ä»¶åä¸é€€å‡ºæ–‡ä»¶æ ‘
      resize_window = true,  -- è‡ªåŠ¨è°ƒæ•´çª—å£å¤§å°
      window_picker = {
        enable = true,
        chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890",
        exclude = {
          filetype = { "notify", "packer", "qf", "diff", "fugitive", "fugitiveblame" },
          buftype = { "nofile", "terminal", "help" },
        },
      },
    },
  },

  -- =========================================================================
  -- === è¿‡æ»¤é…ç½® ===
  -- =========================================================================
  filters = {
    -- é»˜è®¤æ˜¾ç¤ºç‚¹æ–‡ä»¶
    dotfiles = true,
    -- æ’é™¤åˆ—è¡¨ï¼šéšè—å¼€å‘ç¯å¢ƒä¸­çš„ä¸´æ—¶æ–‡ä»¶ã€ç¼“å­˜æ–‡ä»¶å’Œé…ç½®ç›®å½•
    exclude = {
      -- Python ç›¸å…³
      "__pycache__",
      ".ruff_cache",
      ".*\\.egg-info$",  -- Python åŒ…ä¿¡æ¯ç›®å½•

      -- ç‰ˆæœ¬æ§åˆ¶
      ".git",

      -- å¼€å‘å·¥å…·å’Œç¼“å­˜
      ".claude",
      ".DS_Store",  -- macOS ç³»ç»Ÿæ–‡ä»¶
      "Session.vim",  -- Vim ä¼šè¯æ–‡ä»¶

      -- Vim/Neovim ä¸´æ—¶æ–‡ä»¶
      "*.swp",
      ".*\\.swp$",
      ".*\\.swo$",
      ".*\\.swn$",

      -- Python å¼€å‘å·¥å…·
      "uv.lock",  -- uv åŒ…ç®¡ç†å™¨é”æ–‡ä»¶
      "pytest.ini",  -- pytest é…ç½®æ–‡ä»¶
      ".pytest_cache",  -- pytest ç¼“å­˜

      -- IDE é…ç½®
      ".idea",  -- JetBrains IDE é…ç½®

      -- å…¶ä»–
      "node_modules",
      ".cache",
    },
    -- è‡ªå®šä¹‰è¿‡æ»¤å‡½æ•°
    custom = {},
  },

  -- =========================================================================
  -- === æ’åºé…ç½® ===
  -- =========================================================================
  sort = {
    sorter = "name",  -- æŒ‰åç§°æ’åº
    folders_first = true,  -- æ–‡ä»¶å¤¹ä¼˜å…ˆ
  },

  -- =========================================================================
  -- === Git é›†æˆ ===
  -- =========================================================================
  git = {
    enable = true,  -- å¯ç”¨ Git çŠ¶æ€æ˜¾ç¤º
    ignore = true,  -- å¿½ç•¥ .gitignore ä¸­çš„æ–‡ä»¶
    timeout = 400,  -- Git å‘½ä»¤è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
  },

  -- =========================================================================
  -- === å…¶ä»–é…ç½® ===
  -- =========================================================================
  -- è‡ªå®šä¹‰é”®ä½æ˜ å°„
  on_attach = on_attach,

  -- æ›´æ–°é¢‘ç‡
  update_focused_file = {
    enable = true,  -- è‡ªåŠ¨æ›´æ–°ç„¦ç‚¹æ–‡ä»¶
    update_root = false,  -- ä¸æ›´æ–°æ ¹ç›®å½•
    ignore_list = {},
  },

  -- è¯Šæ–­ä¿¡æ¯
  diagnostics = {
    enable = false,  -- æš‚æ—¶ç¦ç”¨è¯Šæ–­æ˜¾ç¤ºï¼ˆå¯åç»­å¯ç”¨ï¼‰
    show_on_dirs = false,
    icons = {
      hint = "ïª",
      info = "ïš",
      warning = "ï±",
      error = "ï—",
    },
  },

  -- ç³»ç»Ÿé›†æˆ
  system_open = {
    cmd = nil,  -- ä½¿ç”¨ç³»ç»Ÿé»˜è®¤ç¨‹åº
    args = {},
  },

  -- æ—¥å¿—çº§åˆ«
  log = {
    enable = false,
    truncate = false,
    types = {
      all = false,
      config = false,
      copy_paste = false,
      dev = false,
      diagnostics = false,
      git = false,
      profile = false,
      watcher = false,
    },
  },
})

-- =============================================================================
-- === å…¨å±€é”®ä½æ˜ å°„ ===
-- =============================================================================
-- è®¾ç½®å…¨å±€å¿«æ·é”®ï¼šF1 é”®æŠ˜å /æ‰“å¼€æ–‡ä»¶æ ‘

vim.keymap.set("n", "<F1>", "<cmd>NvimTreeToggle<CR>", { desc = "æŠ˜å /æ‰“å¼€æ–‡ä»¶æ ‘" })

